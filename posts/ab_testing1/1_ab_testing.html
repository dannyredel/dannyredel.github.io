<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Redel">
<meta name="dcterms.date" content="2024-04-05">

<title>Daniel Redel - A/B Testing Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Daniel Redel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../myposts.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> <i class="bi bi-folder" role="img">
</i> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> <i class="bi bi-person" role="img">
</i> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dannyredel"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/daniel-redel-14b052b6/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DannyRedel"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A/B Testing Analysis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Causal Inference</div>
                <div class="quarto-category">A/B Testing</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Redel </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 5, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#case-study-online-wine-stores-email-campaign-experiment" id="toc-case-study-online-wine-stores-email-campaign-experiment" class="nav-link active" data-scroll-target="#case-study-online-wine-stores-email-campaign-experiment">Case Study: Online Wine Store’s Email Campaign Experiment</a></li>
  <li><a href="#randomization-checks" id="toc-randomization-checks" class="nav-link" data-scroll-target="#randomization-checks">1. Randomization Checks</a>
  <ul class="collapse">
  <li><a href="#violinplots" id="toc-violinplots" class="nav-link" data-scroll-target="#violinplots">1.1. Violinplots</a></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">1.2. Histograms</a></li>
  <li><a href="#t-tests" id="toc-t-tests" class="nav-link" data-scroll-target="#t-tests">1.3. T-Tests</a></li>
  <li><a href="#standardized-mean-difference" id="toc-standardized-mean-difference" class="nav-link" data-scroll-target="#standardized-mean-difference">1.4. Standardized Mean Difference</a></li>
  </ul></li>
  <li><a href="#average-treatment-effects" id="toc-average-treatment-effects" class="nav-link" data-scroll-target="#average-treatment-effects">2. Average Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#difference-in-means" id="toc-difference-in-means" class="nav-link" data-scroll-target="#difference-in-means">2.1. Difference in Means</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">2.2. Linear Regression</a></li>
  <li><a href="#distribution-comparison" id="toc-distribution-comparison" class="nav-link" data-scroll-target="#distribution-comparison">2.3. Distribution Comparison</a></li>
  <li><a href="#email-a-vs-email-b" id="toc-email-a-vs-email-b" class="nav-link" data-scroll-target="#email-a-vs-email-b">2.4. Email A vs Email B</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">3. Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>A/B testing Analysis using Python.</p>
<p>As data scientists, we are frequently confronted with questions like: <strong>“Does <span class="math inline">X</span> affects <span class="math inline">Y</span>?”</strong> Here, <span class="math inline">Y</span> is the outcome that we care about, while <span class="math inline">X</span> could be a new feature, product, policy or experience. For example, a website owner would like to ask if a new web page design leads to a higher click-through rate or sale. Similarly, <a href="https://confidence.spotify.com/blog/ab-tests-and-rollouts">Spotify</a> may to know whether their new interface leads to more minutes of music played, while <a href="https://engineering.zalando.com/posts/2019/02/effectiveness-online-marketing.html">Zalando</a> aims to assess the impact of their marketing actions on purchases.</p>
<p>But how do we go about answering such <strong>causal questions</strong>? For the Platform Economy, the solution <strong>lies in experimentation</strong>. By randomly assigning some kind of treatment (new interface design, new product, etc.) to a subset of users (Group A) and comparing their behavior or outcomes (such as revenue, visits, clicks, etc.) to those who did not receive the treatment (Group B), we can effectively isolate the causal impact of the change. This is at the core of <strong>A/B testing</strong> (also known as Randomized Control Trials), which is considered the workhorse method of experimentation for platforms like <a href="https://confidence.spotify.com/blog/experiment-like-spotify">Spotify</a>, <a href="https://www.uber.com/en-NL/blog/xp/">Uber</a>, <a href="https://netflixtechblog.com/what-is-an-a-b-test-b08cc1b57962">Netflix</a>, an more.</p>
<p>In this article, we will delve into the analysis involved in A/B testing using <strong>Python</strong>, with a specific focus on Randomization Checks and various methods or statistical tools for studying Average Treatment Effects. Let’s go!</p>
<section id="case-study-online-wine-stores-email-campaign-experiment" class="level1">
<h1>Case Study: Online Wine Store’s Email Campaign Experiment</h1>
<p>As as study case, we are going to use an example taken from <a href="https://github.com/eleafeit/ab_test">Elea McDonnell</a> (Drexel University). Imagine we are a <em>‘Total Wine &amp; More’</em>, a well established online wine store who wants to attract more customers and traffic to their website. Suppose our marketing team proposes launching an <strong>email campaign</strong> as a potential solution to drive more traffic and sales. However, before implementing the campaign, they want to conduct a test to determine which type of email design is more effective.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="1_ab_testing_files/figure-html/cell-3-1-wine_store.png" class="img-fluid figure-img"></p>
<figcaption>Source: Total Wine &amp; More</figcaption>
</figure>
</div>
<p>To evaluate the effectiveness of this email campaign, we conducted an <strong>A/B test</strong>. In this experiment, users were <strong>randomly assigned</strong> to one of three groups: one group received Email A, another group received Email B, and the remaining users were assigned to the control group, which did not receive any special email treatment. What’s interesting here is that the design of the test enables us to address two main questions:</p>
<blockquote class="blockquote">
<ol type="1">
<li>Does the email campaign lead to an increase in purchases compared to the control group (Treated vs.&nbsp;Control)?</li>
</ol>
</blockquote>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>Which email design is more effective in driving engagement and sales (Email A vs.&nbsp;Email B)?</li>
</ol>
</blockquote>
<p><a href="#tbl-raw-dataset" class="quarto-xref">Table&nbsp;1</a> presents a sample of the dataset containing all the information we need to commence our analysis. The dataset can be found in <a href="https://github.com/eleafeit/ab_test/blob/master/code/test_data.csv">here</a>.</p>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"viridis"</span>, <span class="dv">3</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'test_data.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-raw-dataset" class="cell quarto-float anchored" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-raw-dataset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Online Wine Store Dataset
</figcaption>
<div aria-describedby="tbl-raw-dataset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">cpgn_id</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">email</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">click</th>
<th data-quarto-table-cell-role="th">purch</th>
<th data-quarto-table-cell-role="th">chard</th>
<th data-quarto-table-cell-role="th">sav_blanc</th>
<th data-quarto-table-cell-role="th">syrah</th>
<th data-quarto-table-cell-role="th">cab</th>
<th data-quarto-table-cell-role="th">past_purch</th>
<th data-quarto-table-cell-role="th">days_since</th>
<th data-quarto-table-cell-role="th">visits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1000001</td>
<td>1901Email</td>
<td>ctrl</td>
<td>False</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>33.94</td>
<td>0.00</td>
<td>33.94</td>
<td>119</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1000002</td>
<td>1901Email</td>
<td>email_B</td>
<td>True</td>
<td>1</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>16.23</td>
<td>76.31</td>
<td>92.54</td>
<td>60</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1000003</td>
<td>1901Email</td>
<td>email_A</td>
<td>True</td>
<td>1</td>
<td>1</td>
<td>200.51</td>
<td>516.39</td>
<td>0.00</td>
<td>16.63</td>
<td>0.00</td>
<td>533.02</td>
<td>9</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1000004</td>
<td>1901Email</td>
<td>email_A</td>
<td>True</td>
<td>1</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>41.21</td>
<td>41.21</td>
<td>195</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1000005</td>
<td>1901Email</td>
<td>email_A</td>
<td>True</td>
<td>1</td>
<td>1</td>
<td>158.30</td>
<td>426.53</td>
<td>1222.48</td>
<td>0.00</td>
<td>0.00</td>
<td>1649.01</td>
<td>48</td>
<td>9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>A quick summary of what we have in this dataset:</p>
<ul>
<li><strong>Treatments</strong>: The dataset includes three groups defined by the <code>group</code> variable: email version A, email version B, and holdout (control group).</li>
<li><strong>Unit</strong>: Each <code>user_id</code> unit in the dataset represents an email address.</li>
<li><strong>Reponse Variables</strong>: We are interested in study causal effects on 3 response variables:
<ul>
<li><code>open</code>: Whether the recipient opened the test email (loaded images).</li>
<li><code>click</code>: Whether the recipient clicked on the test email to visit the website.</li>
<li><code>purch</code>: The amount ($) of purchases made within 30 days after the email was sent.</li>
</ul></li>
<li><strong>Selection</strong>: The dataset consists of data from all active customers.</li>
<li><strong>Assignment</strong>: Participants were randomly assigned to one of the three groups (each group comprising one-third of the total sample).</li>
</ul>
</section>
<section id="randomization-checks" class="level1">
<h1>1. Randomization Checks</h1>
<p>Before assessing causal effects, it’s crucial to ensure that the randomization process was executed correctly. Randomization ensures that, on average, the only difference between the two groups is the treatment, allowing us to attribute outcome differences to the treatment effect.</p>
<p>The reality is that, despite randomization, the two groups are never identical. Therefore, it’s essential, after randomization, to check whether all observed variables are balanced across groups and whether there are no systematic differences.</p>
<p><strong>Randomization checks</strong> serve to confirm <strong>whether baseline variables are distributed similarly across the treatment and control groups</strong>. In our case, referring back to <a href="#tbl-raw-dataset" class="quarto-xref">Table&nbsp;1</a>, the baseline variables of interest include:</p>
<ul>
<li><code>days_since</code>: Days since last activity</li>
<li><code>visits</code>: Number of website visits</li>
<li><code>past_purch</code>: Total past purchases ($)</li>
<li>Total <em>past</em> purchases by category ($): <code>chard</code>, <code>sav_blanc</code>, <code>syrah</code>, <code>cab</code></li>
</ul>
<p>Let’s just compare their means by treatment group:</p>
<div class="cell" data-execution_count="75">
<div id="tbl-baseline1" class="cell quarto-float anchored" data-execution_count="75">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-baseline1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Summary Statistics, by Group
</figcaption>
<div aria-describedby="tbl-baseline1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="75">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">days_since</th>
<th data-quarto-table-cell-role="th">visits</th>
<th data-quarto-table-cell-role="th">past_purch</th>
<th data-quarto-table-cell-role="th">chard</th>
<th data-quarto-table-cell-role="th">sav_blanc</th>
<th data-quarto-table-cell-role="th">syrah</th>
<th data-quarto-table-cell-role="th">cab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ctrl</td>
<td>89.98</td>
<td>5.95</td>
<td>188.27</td>
<td>71.67</td>
<td>73.63</td>
<td>26.45</td>
<td>16.52</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>email_A</td>
<td>90.17</td>
<td>5.95</td>
<td>188.45</td>
<td>73.46</td>
<td>72.10</td>
<td>26.62</td>
<td>16.26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>email_B</td>
<td>89.81</td>
<td>5.94</td>
<td>189.66</td>
<td>74.81</td>
<td>71.63</td>
<td>26.96</td>
<td>16.27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Just by comparing and checking their means in <a href="#tbl-baseline1" class="quarto-xref">Table&nbsp;2</a>, we can already say that the randomization process was successful. On average, users across all treatment groups exhibit similar behavior and characteristics, making them comparable in terms of visits, past purchases, and other relevant factors.</p>
<p>However, we want to go further than just comparing means and also <strong>compare distributions across treatments</strong>. This will ensure a balanced distribution of baseline variables among the treatment and control groups. We’ll explore different methods to compare distributions and assess the magnitude and significance of their differences. We’ll consider two approaches: <strong>visual</strong> and <strong>statistical</strong>.</p>
<section id="violinplots" class="level2">
<h2 class="anchored" data-anchor-id="violinplots">1.1. Violinplots</h2>
<p>A first visual approach is the <a href="https://en.wikipedia.org/wiki/Violin_plot"><strong>violinplot</strong></a>. The violinplot plots depicts distributions of numeric data for one or more groups using <a href="https://math.libretexts.org/Bookshelves/Applied_Mathematics/Math_For_Liberal_Art_Students_2e_(Diaz)/11%3A_Normal_Distribution/11.02%3A_The_Density_Curve_of_a_Normal_Distribution#:~:text=A%20density%20curve%20is%20an,the%20most%20useful%20to%20us."><strong>density curves</strong></a>. These densities —usually smoothed by a <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation"><strong>kernel density estimator</strong></a>— are displayed along the <code>y-axis</code> so that we can compare them. By default, the <code>.violintplot()</code> function from the <code>seaborn</code> library also adds a miniature boxplot inside. <a href="#fig-violinplots" class="quarto-xref">Figure&nbsp;1</a> shows the violinplots of our baseline variables:</p>
<div id="cell-fig-violinplots" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'days_since'</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'days_since'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'days_since'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Days Since Last Activity'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Violinplot of Days Since'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'visits'</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'visits'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'visits'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Visits'</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Violinplot of Website Visits'</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'past_purch'</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'past_purch'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'past_purch'</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'past_purch'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">2</span>])</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_xlabel(<span class="st">'Past Purchases ($)'</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">'Violinplot of Past Purchases'</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'chard'</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'chard'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'chard'</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'chard'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Chardonnay'</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Violinplot of Chardonnay Purchases'</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'sav_blanc'</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'sav_blanc'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'sav_blanc'</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'sav_blanc'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Sauvignon Blanc'</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Violinplot of Sauvignon Blanc Purchases'</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'syrah'</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'syrah'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'syrah'</span>] <span class="op">&lt;</span> <span class="dv">1000</span>)]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'syrah'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_xlabel(<span class="st">'Syrah'</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">'Violinplot of Syrah Purchases'</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'cab'</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'cab'</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'cab'</span>] <span class="op">&lt;</span> <span class="dv">500</span>)]</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'group'</span>, y<span class="op">=</span><span class="st">'cab'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>, <span class="dv">0</span>])</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Cabernet'</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_title(<span class="st">'Violinplot of Cabernet Purchases'</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide the empty subplots</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-violinplots" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-violinplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_ab_testing_files/figure-html/fig-violinplots-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-violinplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Violinplot of Baseline Variables
</figcaption>
</figure>
</div>
</div>
</div>
<p>The shape of the distributions across <code>group</code> is quite similar, indicating comparable distributions of baseline variables. This similarity confirms that the randomization process was successful in achieving balance between the treatment and control groups.</p>
</section>
<section id="histograms" class="level2">
<h2 class="anchored" data-anchor-id="histograms">1.2. Histograms</h2>
<p>Another intuitive way to plot a distribution is the <strong><a href="https://en.wikipedia.org/wiki/Histogram">histogram</a></strong>. The histogram groups the data into equally wide <strong>bins</strong> and plots the number of observations within each bin.</p>
<p>The full distributions of baseline variables should also be the same between treatment groups in this case:</p>
<div id="cell-fig-hist" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'days_since'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'days_since'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">700</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Days Since Last Activity'</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Distribution of days_since by treatment group'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'visits'</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'visits'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'visits'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">1</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlim(<span class="dv">0</span>, <span class="dv">35</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Visits'</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Distribution of website visits by treatment group'</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'past_purch'</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'past_purch'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'past_purch'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>, <span class="dv">2</span>])</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_xlim(<span class="dv">0</span>, <span class="dv">2000</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_xlabel(<span class="st">'Past Purchases ($)'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">'Distribution of past purchases by treatment group'</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'chard'</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'chard'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'chard'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">2000</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Chardonnay'</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Distribution of Chardonnay by treatment group'</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'sav_blanc'</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'sav_blanc'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'sav_blanc'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_xlim(<span class="dv">0</span>, <span class="dv">2000</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Sauvignon Blanc'</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Distribution of Sauvignon Blanc by treatment group'</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'syrah'</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'syrah'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'syrah'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_xlim(<span class="dv">0</span>, <span class="dv">1000</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_xlabel(<span class="st">'Syrah'</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">'Distribution of Syrah by treatment group'</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for 'cab'</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'cab'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>filtered_df, x<span class="op">=</span><span class="st">'cab'</span>, hue<span class="op">=</span><span class="st">'group'</span>, binwidth<span class="op">=</span><span class="dv">25</span>, stat<span class="op">=</span><span class="st">'density'</span>, common_norm<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, multiple<span class="op">=</span><span class="st">'stack'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[<span class="dv">2</span>, <span class="dv">0</span>])</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">500</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Cabernet'</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Customers'</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>, <span class="dv">0</span>].set_title(<span class="st">'Distribution of Cabernet by treatment group'</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide empty subplots</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axs.flat[<span class="dv">7</span>:]:</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">'off'</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-hist" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_ab_testing_files/figure-html/fig-hist-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Histograms of Baseline Variables
</figcaption>
</figure>
</div>
</div>
</div>
<p>Randomization checks out again!</p>
</section>
<section id="t-tests" class="level2">
<h2 class="anchored" data-anchor-id="t-tests">1.3. T-Tests</h2>
<p>Now that we’ve visualized differences between distributions, let’s move on to a more rigorous approach for <em>assessing statistical significance</em>. Visualization provides <strong>intuition</strong> by allowing us to visually inspect differences, but we also want to be able to quantify the significance of these differences.</p>
<p>The most common test is the <a href="https://en.wikipedia.org/wiki/Student%27s_t-test">student t-test</a>. T-tests are generally used to <strong>compare means</strong>. In this case, we want to test whether the means of the <code>days_since</code>, <code>visits</code> and <code>past_purch</code> distribution are the same across two groups: Treated (Email A + Email B) vs.&nbsp;Control. This test statistic is given by:</p>
<p><span class="math display">
stat = \frac{|\bar x_1 - \bar x_2|}{\sqrt{s^2 / n }}
</span></p>
<p>Where <span class="math inline">\bar x</span> is the sample mean and <span class="math inline">s</span> is the sample standard deviation. Under mild conditions, the test statistic is asymptotically distributed as a <a href="https://en.wikipedia.org/wiki/Student%27s_t-distribution">student t</a> distribution.</p>
<p>We use the <code>ttest_ind</code> function from <code>scipy</code> to perform the t-test. The function returns both the test statistic and the implied <a href="https://en.wikipedia.org/wiki/P-value">p-value</a>.</p>
<div id="cell-20" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ttest_ind</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Treated vs Control Categorical Variable</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'treat'</span>] <span class="op">=</span> df[<span class="st">'group'</span>].<span class="bu">map</span>({<span class="st">'email_A'</span>: <span class="st">'treated'</span>, <span class="st">'email_B'</span>: <span class="st">'treated'</span>, <span class="st">'ctrl'</span>: <span class="st">'control'</span>})</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Days Since</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>days_since_treated <span class="op">=</span> df.loc[df.treat<span class="op">==</span><span class="st">'treated'</span>, <span class="st">'days_since'</span>].values</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>days_since_ctrl <span class="op">=</span> df.loc[df.treat<span class="op">==</span><span class="st">'control'</span>, <span class="st">'days_since'</span>].values</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> ttest_ind(days_since_treated, days_since_ctrl)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"days_since t-test: statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>days_since t-test: statistic=0.0154, p-value=0.9877</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>visits t-test: statistic=-0.2451, p-value=0.8064
past_purch t-test: statistic=0.4345, p-value=0.6639</code></pre>
</div>
</div>
<p>The p-values from these tests all are above 0.1, therefore we do <strong>not reject</strong> the null hypothesis of no difference in <em>means</em> across treatment and control groups.</p>
<p>The thing is, our example has m<strong>ore than 2 groups to compare</strong>. With multiple groups, the most popular test is the <a href="https://en.wikipedia.org/wiki/F-test"><strong>F-test</strong></a>. The F-test compares the variance of a variable across different groups. The F-test statistic is</p>
<p><span class="math display">
\text{stat} = \frac{\text{between-group variance}}{\text{within-group variance}} = \frac{\sum_{g} \big( \bar x_g - \bar x \big) / (G-1)}{\sum_{g} \sum_{i \in g} \big( \bar x_i - \bar x_g \big) / (N-G)}
</span></p>
<p>Where <span class="math inline">G</span> is the number of groups, <span class="math inline">N</span> is the number of observations, <span class="math inline">\bar x</span> is the overall mean and <span class="math inline">\bar x_g</span> is the mean within group <span class="math inline">g</span>. Under the null hypothesis of group independence, the f-statistic is <a href="https://en.wikipedia.org/wiki/F-distribution">F-distributed</a>.</p>
<div id="cell-24" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> f_oneway</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Days Since</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>days_since_A <span class="op">=</span> df.loc[df.group<span class="op">==</span><span class="st">'email_A'</span>, <span class="st">'days_since'</span>].values</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>days_since_B <span class="op">=</span> df.loc[df.group<span class="op">==</span><span class="st">'email_B'</span>, <span class="st">'days_since'</span>].values</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>days_since_ctrl <span class="op">=</span> df.loc[df.group<span class="op">==</span><span class="st">'ctrl'</span>, <span class="st">'days_since'</span>].values</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> f_oneway(days_since_A, days_since_B, days_since_ctrl)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"days_since F-statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>days_since F-statistic=0.1642, p-value=0.8485</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="6">
<div class="cell-output cell-output-stdout">
<pre><code>visits F-statistic=0.0336, p-value=0.9670
past_purch F-statistic=0.2618, p-value=0.7697</code></pre>
</div>
</div>
<p>Here again, the p-values are telling us that these distributions across treatment are likely similar.</p>
</section>
<section id="standardized-mean-difference" class="level2">
<h2 class="anchored" data-anchor-id="standardized-mean-difference">1.4. Standardized Mean Difference</h2>
<p>In general, it is good practice to always perform a test for difference in means on <strong>all variables</strong> across the treatment and control group, when we are running A/B tests. However, since the denominator of the t-test statistic depends on the sample size, the corresponding p-values are not directly comparable across studies.</p>
<p>As alternative, we can use the <strong>standardized mean difference (SMD)</strong>, which is just a standardized difference, which can be computed as:</p>
<p><span class="math display">
SMD = \frac{|\bar x_1 - \bar x_2|}{\sqrt{(s^2_1 + s^2_2) / 2}}
</span></p>
<p>Usually a value below <span class="math inline">0.1</span> is considered a “small” difference.</p>
<p>It is good practice to collect average values of all variables across treatment and control group and a measure of distance between the two — either the t-test or the SMD — into a table that is called <strong>balance table</strong>.</p>
<p>Let’s use the <a href="https://causalml.readthedocs.io/en/latest/causalml.html#module-causalml.match"><code>create_table_one</code></a> function from the <a href="https://causalml.readthedocs.io/en/latest/about.html"><code>causalml</code></a> library to generate it.</p>
<div id="cell-29" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> smd(feature, treatment):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate the standard mean difference (SMD) of a feature between the</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    treatment and control groups.</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">        feature (pandas.Series): a column of a feature to calculate SMD for</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">        treatment (pandas.Series): a column that indicate whether a row is in</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">                                   the treatment group or not</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">        (float): The SMD of the feature</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> feature[treatment <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> feature[treatment <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (t.mean() <span class="op">-</span> c.mean()) <span class="op">/</span> np.sqrt(<span class="fl">0.5</span> <span class="op">*</span> (t.var() <span class="op">+</span> c.var()))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_table_one(data, treatment_col, features):</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Report balance in input features between the treatment and control groups.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">        data (pandas.DataFrame): total or matched sample data</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">        treatment_col (str): the column name for the treatment</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">        features (list of str): the column names of features</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">        (pandas.DataFrame): A table with the means and standard deviations in</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">            the treatment and control groups, and the SMD between two groups</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">            for the features.</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> pd.pivot_table(</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        data[features <span class="op">+</span> [treatment_col]],</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>treatment_col,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        aggfunc<span class="op">=</span>[<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{:.2f}</span><span class="st"> (</span><span class="sc">{:.2f}</span><span class="st">)"</span>.<span class="bu">format</span>(x.mean(), x.std())],</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    t1.columns <span class="op">=</span> t1.columns.droplevel(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    t1[<span class="st">"SMD"</span>] <span class="op">=</span> data[features].<span class="bu">apply</span>(<span class="kw">lambda</span> x: smd(x, data[treatment_col])).<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    n_row <span class="op">=</span> pd.pivot_table(</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        data[[features[<span class="dv">0</span>], treatment_col]], columns<span class="op">=</span>treatment_col, aggfunc<span class="op">=</span>[<span class="st">"count"</span>]</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    n_row.columns <span class="op">=</span> n_row.columns.droplevel(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    n_row[<span class="st">"SMD"</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    n_row.index <span class="op">=</span> [<span class="st">"n"</span>]</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> pd.concat([n_row, t1], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    t1.columns.name <span class="op">=</span> <span class="st">""</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    t1.columns <span class="op">=</span> [<span class="st">"Control"</span>, <span class="st">"Treatment"</span>, <span class="st">"SMD"</span>]</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    t1.index.name <span class="op">=</span> <span class="st">"Variable"</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'treat'</span>] <span class="op">=</span> df[<span class="st">'group'</span>].<span class="bu">map</span>({<span class="st">'email_A'</span>: <span class="dv">1</span>, <span class="st">'email_B'</span>: <span class="dv">1</span>, <span class="st">'ctrl'</span>: <span class="dv">0</span>})</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>create_table_one(df, <span class="st">'treat'</span>, [<span class="st">'days_since'</span>, <span class="st">'visits'</span>, <span class="st">'past_purch'</span>, <span class="st">'chard'</span>, <span class="st">'sav_blanc'</span>, <span class="st">'syrah'</span>, <span class="st">'cab'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-balancetable" class="cell quarto-float anchored" data-execution_count="5">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-balancetable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Balance Table
</figcaption>
<div aria-describedby="tbl-balancetable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Control</th>
<th data-quarto-table-cell-role="th">Treatment</th>
<th data-quarto-table-cell-role="th">SMD</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">n</td>
<td>41330</td>
<td>82658</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cab</td>
<td>16.52 (47.27)</td>
<td>16.26 (46.67)</td>
<td>-0.0053</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">chard</td>
<td>71.67 (199.39)</td>
<td>74.14 (211.84)</td>
<td>0.012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">days_since</td>
<td>89.98 (89.50)</td>
<td>89.99 (89.95)</td>
<td>0.0001</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">past_purch</td>
<td>188.27 (298.18)</td>
<td>189.06 (303.33)</td>
<td>0.0026</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sav_blanc</td>
<td>73.63 (203.37)</td>
<td>71.87 (197.25)</td>
<td>-0.0088</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">syrah</td>
<td>26.45 (73.91)</td>
<td>26.79 (75.04)</td>
<td>0.0045</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">visits</td>
<td>5.95 (2.85)</td>
<td>5.94 (2.86)</td>
<td>-0.0015</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>In the first two columns of <a href="#tbl-balancetable" class="quarto-xref">Table&nbsp;3</a>, we observe the average of the different variables across the treatment and control groups, with standard errors provided in parentheses. However, it’s in the <strong>last column</strong> where the values of the standardized mean difference (SMD) are presented. A standardized difference below <span class="math inline">|0.1|</span> for all variables suggests that the two groups are likely similar.</p>
</section>
</section>
<section id="average-treatment-effects" class="level1">
<h1>2. Average Treatment Effects</h1>
<p>Now, at last, we stand ready to estimate the effectiveness of our email campaign. Let’s recall our main causal questions:</p>
<blockquote class="blockquote">
<ol type="1">
<li>Does the email campaign lead to an increase in purchases (<code>purch</code>) compared to the control group (Treated vs.&nbsp;Control)?</li>
</ol>
</blockquote>
<div class="cell" data-execution_count="3">
<div id="tbl-ate-table" class="cell quarto-float anchored" data-execution_count="3">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ate-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Mean Response, by Treatment
</figcaption>
<div aria-describedby="tbl-ate-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">treat</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">click</th>
<th data-quarto-table-cell-role="th">purch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>control</td>
<td>0.00</td>
<td>0.00</td>
<td>12.42</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>treated</td>
<td>0.68</td>
<td>0.11</td>
<td>25.74</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>Which email design is more effective in driving engagement (<code>open</code>, <code>click</code>) and sales (<code>purch</code>) (Email A vs.&nbsp;Email B)?</li>
</ol>
</blockquote>
<div class="cell" data-execution_count="7">
<div id="tbl-ate-table1" class="cell quarto-float anchored" data-execution_count="7">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ate-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Mean Response, by Group
</figcaption>
<div aria-describedby="tbl-ate-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">open</th>
<th data-quarto-table-cell-role="th">click</th>
<th data-quarto-table-cell-role="th">purch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ctrl</td>
<td>0.00</td>
<td>0.00</td>
<td>12.42</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>email_A</td>
<td>0.72</td>
<td>0.13</td>
<td>25.62</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>email_B</td>
<td>0.65</td>
<td>0.09</td>
<td>25.87</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<section id="difference-in-means" class="level2">
<h2 class="anchored" data-anchor-id="difference-in-means">2.1. Difference in Means</h2>
<p>Let’s start with the first causal question (Treated vs Control). We can just compare the average outcome post-treatment <span class="math inline">Y_1</span> across control and treated units and randomization guarantees that this difference is, on average, due to the treatment alone:</p>
<p><span class="math display">
\widehat {ATE}^{simple} = \bar Y_{t=1, d=1} - \bar Y_{t=1, d=0}
</span></p>
<p>In our case, we compute the average purchases (<code>purch</code>) after the campaign in the treatment group, minus the average revenue post ad campaign in the control group:</p>
<div id="cell-39" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ate <span class="op">=</span> df.loc[df.treat <span class="op">==</span> <span class="st">'treated'</span>, <span class="st">'purch'</span>].mean() <span class="op">-</span> df.loc[df.treat <span class="op">==</span> <span class="st">'control'</span>, <span class="st">'purch'</span>].mean()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n_treat <span class="op">=</span> df[df.treat <span class="op">==</span> <span class="st">'treated'</span>].shape[<span class="dv">0</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="ss">f'Average Treatment Effects: $</span><span class="sc">{</span>ate<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span> )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="ss">f'Average Increased Revenues: $</span><span class="sc">{</span><span class="bu">round</span>(ate<span class="op">*</span>n_treat)<span class="sc">:,.0f}</span><span class="ss">'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average Treatment Effects: $13.32
Average Increased Revenues: $1,101,358</code></pre>
</div>
</div>
<p>This <span class="math inline">\text{ATE}</span> is telling us that, on average, each recipient of the email campaign resulted in an <strong>additional revenue of $13.32</strong> compared to those who did not receive the campaign. In other words, the email campaign had a positive impact on increasing purchases.</p>
<p>This suggests that, overall, the email campaign resulted in an increased revenues of $1,101,358.</p>
</section>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">2.2. Linear Regression</h2>
<p>We can obtain the same estimate by regressing the post-treatment outcome <code>purch</code> on the treatment indicator <code>treat</code>:</p>
<p><span class="math display">
Y_{i} = \alpha + \beta D_i + \varepsilon_i
</span></p>
<p>where <span class="math inline">D_i</span> is the treatment indicator (equal to 1 for treated units and 0 for control units), <span class="math inline">\alpha</span> is the intercept term and <span class="math inline">\beta</span> is our coefficient of interest representing the <strong>Average Treatment Effect</strong>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>smf.ols(<span class="st">'purch ~ treat'</span>, data<span class="op">=</span>df).fit().summary().tables[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-reg1" class="cell quarto-float anchored" data-execution_count="8">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-reg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: A/B Regression Results I
</figcaption>
<div aria-describedby="tbl-reg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<table class="simpletable do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>12.4203</td>
<td>0.268</td>
<td>46.360</td>
<td>0.000</td>
<td>11.895</td>
<td>12.945</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">treat[T.treated]</td>
<td>13.3243</td>
<td>0.328</td>
<td>40.608</td>
<td>0.000</td>
<td>12.681</td>
<td>13.967</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>The advantage of running a linear regression is that we can directly test whether the difference in outcomes between the treatment and control groups is <strong>statistically significant</strong>, providing us with more robust information regarding the effectiveness of the campaign.</p>
<p><a href="#tbl-reg1" class="quarto-xref">Table&nbsp;6</a> is not only confirming an <span class="math inline">\text{ATE}</span> of $13.32, but also telling us that this difference is statistically different from zero. This provides stronger evidence regarding the effectiveness of the email campaign in increasing purchases compared to the control group.</p>
<p>We can also compare both types of campaigns against our control group:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>smf.ols(<span class="st">'purch ~ group'</span>, data<span class="op">=</span>df).fit().summary().tables[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-reg2" class="cell quarto-float anchored" data-execution_count="9">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-reg2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: A/B Regression Results II
</figcaption>
<div aria-describedby="tbl-reg2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<table class="simpletable do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>12.4203</td>
<td>0.268</td>
<td>46.360</td>
<td>0.000</td>
<td>11.895</td>
<td>12.945</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">group[T.email_A]</td>
<td>13.2026</td>
<td>0.379</td>
<td>34.846</td>
<td>0.000</td>
<td>12.460</td>
<td>13.945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">group[T.email_B]</td>
<td>13.4460</td>
<td>0.379</td>
<td>35.488</td>
<td>0.000</td>
<td>12.703</td>
<td>14.189</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>It’s important to note that this regression results in <a href="#tbl-reg2" class="quarto-xref">Table&nbsp;7</a> are not directly addressing our second causal question (Email A vs.&nbsp;Email B). Instead, the coefficients obtained from the regression are comparing each email campaign against the control group. In any case, the table suggests that, on average, Campaign B generates more purchases. It remains to be determined whether this difference is statistically significant.</p>
</section>
<section id="distribution-comparison" class="level2">
<h2 class="anchored" data-anchor-id="distribution-comparison">2.3. Distribution Comparison</h2>
<p><a href="#fig-ate-dist0" class="quarto-xref">Figure&nbsp;3</a> illustrates the purchase distribution by treatment, providing a comprehensive view of the data. However, it’s important to note that while we have established a statistically significant difference, our estimation of this distribution <strong>assumes a Normal Distribution</strong>, which may not always hold true. In future articles, we will delve deeper into alternative methods that do not rely on such assumptions, ensuring a more robust analysis.</p>
<div id="cell-fig-ate-dist0" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Control vs Treated</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>df_control <span class="op">=</span> df[df[<span class="st">'treat'</span>] <span class="op">==</span> <span class="st">'control'</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>df_treated <span class="op">=</span> df[df[<span class="st">'treat'</span>] <span class="op">==</span> <span class="st">'treated'</span>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and standard error for email_A and email_B</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>mean_open_A <span class="op">=</span> df_control[<span class="st">'purch'</span>].mean()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>std_error_A <span class="op">=</span> df_control[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_control))</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>mean_open_B <span class="op">=</span> df_treated[<span class="st">'purch'</span>].mean()</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>std_error_B <span class="op">=</span> df_treated[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_treated))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>normal_data_A <span class="op">=</span> np.random.normal(mean_open_A, std_error_A, <span class="dv">10000</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>normal_data_B <span class="op">=</span> np.random.normal(mean_open_B, std_error_B, <span class="dv">10000</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>sns.histplot(normal_data_A, kde<span class="op">=</span><span class="va">True</span>, stat<span class="op">=</span><span class="st">'density'</span>, label<span class="op">=</span><span class="st">'Control'</span>, bins<span class="op">=</span><span class="dv">20</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>sns.histplot(normal_data_B, kde<span class="op">=</span><span class="va">True</span>, stat<span class="op">=</span><span class="st">'density'</span>, label<span class="op">=</span><span class="st">'Treated'</span>, bins<span class="op">=</span><span class="dv">20</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Purchases'</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Purchases, by Treatment'</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_open_A, color<span class="op">=</span>sns.color_palette()[<span class="dv">0</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean Control'</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_open_B, color<span class="op">=</span>sns.color_palette()[<span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean Treated'</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>plt.errorbar(mean_open_A, <span class="fl">0.02</span>, xerr<span class="op">=</span>std_error_A, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>sns.color_palette()[<span class="dv">0</span>], label<span class="op">=</span><span class="st">'95% CI Control'</span>)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>plt.errorbar(mean_open_B, <span class="fl">0.02</span>, xerr<span class="op">=</span>std_error_B, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>sns.color_palette()[<span class="dv">1</span>], label<span class="op">=</span><span class="st">'95% CI Treated'</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">3</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>), loc<span class="op">=</span><span class="st">'upper center'</span>) </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-ate-dist0" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ate-dist0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_ab_testing_files/figure-html/fig-ate-dist0-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ate-dist0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Purchase Distribution, by Treatment
</figcaption>
</figure>
</div>
</div>
</div>
<p>Again, assuming Normality, we can also estimate confidence intervals:</p>
<div id="cell-51" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df_control <span class="op">=</span> df[df[<span class="st">'treat'</span>] <span class="op">==</span> <span class="st">'control'</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>df_treated <span class="op">=</span> df[df[<span class="st">'treat'</span>] <span class="op">==</span> <span class="st">'treated'</span>]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and standard error for email_A and email_B</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>mean_open_A <span class="op">=</span> df_control[<span class="st">'purch'</span>].mean()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>std_error_A <span class="op">=</span> df_control[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_control))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>mean_open_B <span class="op">=</span> df_treated[<span class="st">'purch'</span>].mean()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>std_error_B <span class="op">=</span> df_treated[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_treated))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the confidence interval using the t-distribution</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>confidence_interval_A <span class="op">=</span> stats.norm.interval(<span class="fl">0.95</span>, loc<span class="op">=</span>mean_open_A, scale<span class="op">=</span>std_error_A)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>confidence_interval_B <span class="op">=</span> stats.norm.interval(<span class="fl">0.95</span>, loc<span class="op">=</span>mean_open_B, scale<span class="op">=</span>std_error_B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-52" class="cell" data-execution_count="38">
<div class="cell-output cell-output-stdout">
<pre><code>Mean Response Control: 12.4
Mean Response Treated: 25.7
95% Confidence Interval for Control: [12.00, 12.84]
95% Confidence Interval for Treated: [25.34, 26.15]</code></pre>
</div>
</div>
</section>
<section id="email-a-vs-email-b" class="level2">
<h2 class="anchored" data-anchor-id="email-a-vs-email-b">2.4. Email A vs Email B</h2>
<p>Now, let’s turn our attention to the second causal question: <strong>Which email design, Email A or Email B, is more effective in driving engagement and sales?</strong></p>
<div id="cell-fig-ate-dist2" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_variable_comparison(df):</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    variables <span class="op">=</span> [<span class="st">'open'</span>, <span class="st">'click'</span>, <span class="st">'purch'</span>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">6</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, variable <span class="kw">in</span> <span class="bu">enumerate</span>(variables):</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Control vs Treated</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        df_control <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'email_A'</span>]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        df_treated <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'email_B'</span>]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate mean and standard error for control and treated groups</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        mean_control <span class="op">=</span> df_control[variable].mean()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        std_error_control <span class="op">=</span> df_control[variable].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_control))</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        mean_treated <span class="op">=</span> df_treated[variable].mean()</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        std_error_treated <span class="op">=</span> df_treated[variable].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_treated))</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate normal distribution data for control and treated groups</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        normal_data_control <span class="op">=</span> np.random.normal(mean_control, std_error_control, <span class="dv">10000</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        normal_data_treated <span class="op">=</span> np.random.normal(mean_treated, std_error_treated, <span class="dv">10000</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot histograms for control and treated groups</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        sns.histplot(normal_data_control, kde<span class="op">=</span><span class="va">True</span>, stat<span class="op">=</span><span class="st">'density'</span>, label<span class="op">=</span><span class="st">'Control'</span>, bins<span class="op">=</span><span class="dv">20</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[i])</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>        sns.histplot(normal_data_treated, kde<span class="op">=</span><span class="va">True</span>, stat<span class="op">=</span><span class="st">'density'</span>, label<span class="op">=</span><span class="st">'Treated'</span>, bins<span class="op">=</span><span class="dv">20</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>axs[i])</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set labels and title</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        axs[i].set_xlabel(<span class="ss">f'</span><span class="sc">{</span>variable<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        axs[i].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>        axs[i].set_title(<span class="ss">f'Distribution of </span><span class="sc">{</span>variable<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss">, by Treatment'</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot mean and error bars</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        axs[i].axvline(mean_control, color<span class="op">=</span>sns.color_palette()[<span class="dv">0</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean Control'</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        axs[i].axvline(mean_treated, color<span class="op">=</span>sns.color_palette()[<span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Mean Treated'</span>)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        axs[i].errorbar(mean_control, <span class="fl">0.02</span>, xerr<span class="op">=</span>std_error_control, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>sns.color_palette()[<span class="dv">0</span>], label<span class="op">=</span><span class="st">'95% CI Control'</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        axs[i].errorbar(mean_treated, <span class="fl">0.02</span>, xerr<span class="op">=</span>std_error_treated, fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span>sns.color_palette()[<span class="dv">1</span>], label<span class="op">=</span><span class="st">'95% CI Treated'</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add legend</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">#axs[i].legend(ncol=3, bbox_to_anchor=(0.5, -0.15), loc='upper center') </span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    handles, labels <span class="op">=</span> axs[i].get_legend_handles_labels()</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    fig.legend(handles, labels, loc<span class="op">=</span><span class="st">'upper center'</span>, ncol<span class="op">=</span><span class="dv">3</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="fl">0.0</span>))</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>plot_variable_comparison(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-ate-dist2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ate-dist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="1_ab_testing_files/figure-html/fig-ate-dist2-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ate-dist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Outcome Distribution, by AB Treatment
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df_email_A <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'email_A'</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df_email_B <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> <span class="st">'email_B'</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and standard error for email_A and email_B</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>mean_open_A <span class="op">=</span> df_email_A[<span class="st">'purch'</span>].mean()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>std_error_A <span class="op">=</span> df_email_A[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_email_A))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>mean_open_B <span class="op">=</span> df_email_B[<span class="st">'purch'</span>].mean()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>std_error_B <span class="op">=</span> df_email_B[<span class="st">'purch'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(df_email_B))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the confidence interval using the t-distribution</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>confidence_interval_A <span class="op">=</span> stats.norm.interval(<span class="fl">0.95</span>, loc<span class="op">=</span>mean_open_A, scale<span class="op">=</span>std_error_A)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>confidence_interval_B <span class="op">=</span> stats.norm.interval(<span class="fl">0.95</span>, loc<span class="op">=</span>mean_open_B, scale<span class="op">=</span>std_error_B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-57" class="cell" data-execution_count="6">
<div class="cell-output cell-output-stdout">
<pre><code>Mean Response email_A: 25.6
Mean Response email_B: 25.9
95% Confidence Interval for email_A: [25.06, 26.19]
95% Confidence Interval for email_B: [25.29, 26.44]</code></pre>
</div>
</div>
<p>Interestingly enough, Email A appears to outperform Email B in terms of <strong>opens</strong> and <strong>clicks</strong> (<a href="#fig-ate-dist2" class="quarto-xref">Figure&nbsp;4</a>). However, <strong>this level of engagement does not necessarily translate to higher purchase rates.</strong> Purchases from Email B are higher on average, but the large overlap in their distribution is telling us that this difference might not be significant. While purchases from Email B are higher on average, the large overlap in their distribution suggests that this difference might not be significant.</p>
<p>To confirm this conclusion, we can conduct a linear regression comparing Email A and Email B purchases:</p>
<div class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_ab <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">!=</span> <span class="st">'ctrl'</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>smf.ols(<span class="st">'purch ~ group'</span>, data<span class="op">=</span>df_ab).fit().summary().tables[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-reg3" class="cell quarto-float anchored" data-execution_count="65">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-reg3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8: A/B Regression Results III
</figcaption>
<div aria-describedby="tbl-reg3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="65">
<div>
<table class="simpletable do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>25.6228</td>
<td>0.291</td>
<td>88.070</td>
<td>0.000</td>
<td>25.053</td>
<td>26.193</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">group[T.email_B]</td>
<td>0.2435</td>
<td>0.411</td>
<td>0.592</td>
<td>0.554</td>
<td>-0.563</td>
<td>1.050</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>Indeed, despite observing higher purchases associated with Email B, the obtained p-value of 0.554 indicates that this difference is <strong>not statistically significant</strong>.</p>
<p>These findings show how important it is to look at different metrics and really dig into the data to figure out what’s working best for engaging customers and boosting sales.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>3. Conclusion</h1>
<p>In this post, we’ve explored a variety of methods and tools used for <strong>A/B testing analysis</strong>, ranging from visual comparisons to statistical tests and regression analysis. Each approach offers cool insights about the quality of our randomization and also about the causal effect of our marketing campaigns.</p>
<p>Looking ahead, in a next article on AB testing, I’ll take a deep dive into <strong>Bayesian methods</strong> and <strong>nonparametric estimation</strong> of standard errors for uncertainty. These techniques are particularly valuable when we aim to avoid assumptions about the distribution behavior, offering robust alternatives for analyzing and interpreting A/B testing results in real-world scenarios.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/dannyredel\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2026, Daniel Redel</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>