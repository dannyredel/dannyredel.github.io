<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Redel">
<meta name="dcterms.date" content="2022-12-11">

<title>Daniel Redel - Nonparametric &amp; Semiparametric Binary-Choice Regressions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Daniel Redel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../myposts.html"> <i class="bi bi-newspaper" role="img">
</i> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> <i class="bi bi-folder" role="img">
</i> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> <i class="bi bi-person" role="img">
</i> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dannyredel"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/daniel-redel-14b052b6/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DannyRedel"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Nonparametric &amp; Semiparametric Binary-Choice Regressions</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Nonparametric Regression</div>
                <div class="quarto-category">Semiparametric Regression</div>
                <div class="quarto-category">Binary Choice Models</div>
                <div class="quarto-category">Kernel Density Estimation</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Redel </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 11, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#binary-choice-models" id="toc-binary-choice-models" class="nav-link active" data-scroll-target="#binary-choice-models">Binary Choice Models</a>
  <ul class="collapse">
  <li><a href="#kernel-density-estimation" id="toc-kernel-density-estimation" class="nav-link" data-scroll-target="#kernel-density-estimation">Kernel Density Estimation</a></li>
  <li><a href="#binary-choice-model-probit" id="toc-binary-choice-model-probit" class="nav-link" data-scroll-target="#binary-choice-model-probit">Binary Choice Model (<code>probit</code>)</a></li>
  <li><a href="#normality-assumption" id="toc-normality-assumption" class="nav-link" data-scroll-target="#normality-assumption">Normality Assumption</a></li>
  <li><a href="#heteroscedastic-probit-model" id="toc-heteroscedastic-probit-model" class="nav-link" data-scroll-target="#heteroscedastic-probit-model">Heteroscedastic Probit Model</a></li>
  <li><a href="#nonparametric-regression" id="toc-nonparametric-regression" class="nav-link" data-scroll-target="#nonparametric-regression">Nonparametric Regression</a></li>
  <li><a href="#klein-spady-semiparametric-regression" id="toc-klein-spady-semiparametric-regression" class="nav-link" data-scroll-target="#klein-spady-semiparametric-regression">Klein &amp; Spady Semiparametric Regression</a></li>
  <li><a href="#semiparametric-regression-visualization" id="toc-semiparametric-regression-visualization" class="nav-link" data-scroll-target="#semiparametric-regression-visualization">Semiparametric Regression Visualization</a></li>
  <li><a href="#restricted-model" id="toc-restricted-model" class="nav-link" data-scroll-target="#restricted-model">Restricted Model</a></li>
  <li><a href="#nonparametric-and-semiparametric-regression-comparison" id="toc-nonparametric-and-semiparametric-regression-comparison" class="nav-link" data-scroll-target="#nonparametric-and-semiparametric-regression-comparison">Nonparametric and Semiparametric Regression Comparison</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Nonparametric Kernel Density, Nonparametric Regression and Binary-Choice Models.</p>
<p>The data set used in this assignment comes from Pindyck and Rubinfeld (1998) <em>“<a href="https://www.amazon.com/Econometric-Models-Economic-Forecasts-Pindyck/dp/0079132928">Econometric Models and Economic Forecasts</a>”</em> and contains the following variables: a dummy whether children attend private school (<code>private</code>), number of years the family has been at the present residence (<code>years</code>), log of property tax (<code>logptax</code>), log of income (<code>loginc</code>), and whether one voted for an increase in property taxes (<code>vote</code>). There are two dependent variables of interest -private and vote- which can be modeled individually by two univariate probit models or jointly by one bivariate probit model, for instance.</p>
<p>Link to PDF <a href="https://github.com/dannyredel/Microeconometrics/blob/main/Assignment%204/Assignment_4_redel_u750349.pdf">HERE</a>.</p>
<section id="binary-choice-models" class="level1">
<h1>Binary Choice Models</h1>
<section id="kernel-density-estimation" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-estimation">Kernel Density Estimation</h2>
<p>Before running a binary choice model to explain the voting choice, we plot different Kernel Density estimates of <code>loginc</code> to check whether it follows approximately a normal distribution. The idea is to test visually if the normal distribution falls within the 95% confidence interval area of each kernel density estimate:</p>
<div id="fig-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Kernel Density Estimation of Log(Income)
</figcaption>
</figure>
</div>
<p>All these Kernel Density estimators in <a href="#fig-1" class="quarto-xref">Figure&nbsp;1</a> use an alternative Epanechnikov Kernel function (this is the default in the <code>kdens</code> command in <code>STATA</code>). The differences among the estimator are explained by the different methods of choosing the Optimal Bandwidth <span class="math inline">\(h^*\)</span> that minimizes the Mean Integrated Squared Errors (MISE)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Comparing the kernel densities of the log income against the normal distribution, we observe that the normal distribution seems to not quite fit inside the confidence intervals in none of the kernel estimators. While the case of an optimal bandwidth of <span class="math inline">\(h^*=0.188\)</span> in Figure 1.b. seems to present some evidence about normality, you can still see how the purple line appears outside the boundaries around the 9 to 9.5 value.</p>
<p>Both Plug-in methods (Figure 1.a. and 1.c.) use a lower Optimal Bandwidth (0.11 and 0.12, respectively), thus, leading to less bias but more variance in their estimates. In these cases, the normal distribution line appears outside the 95% confidence boundaries in several places. Overall, the visual test seems to reject the hypothesis that log incomes follow a normal distribution.</p>
</section>
<section id="binary-choice-model-probit" class="level2">
<h2 class="anchored" data-anchor-id="binary-choice-model-probit">Binary Choice Model (<code>probit</code>)</h2>
<p>Table 1 reports the results of different Binary choice models to predict voting behavior using <code>years</code>, <code>logptax</code> and <code>loginc</code> as independent variables:</p>
<div id="tbl-1" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Binary Choice Model Results
</figcaption>
<div aria-describedby="tbl-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="table1.png" class="img-fluid figure-img">
</div>
</figure>
</div>
<p>Column 1 in <a href="#tbl-1" class="quarto-xref">Table&nbsp;1</a> presents the results of the probit model. Here we see a positive and statistically significant relationship between the level of log income and the probability of voting for higher property taxes. Also, once again we observe that property taxes have a negative effect on voting in favor of higher taxes of this kind. Finally, the number of years in the residence did not report a significant result.</p>
</section>
<section id="normality-assumption" class="level2">
<h2 class="anchored" data-anchor-id="normality-assumption">Normality Assumption</h2>
<p>We can use a visual test to check the normality assumption of the probit model estimated in Column 1. Recall that in the probit model, the probability that <span class="math inline">\(y_i\)</span> takes on the value 1 is modeled as a nonlinear function of a linear combination of a set of independent variables:</p>
<p><span class="math display">\[
\Pr(y_i=1|x_i)  = \Phi(x_i'\beta)
\]</span></p>
<p>where <span class="math inline">\(\Phi(\cdot)\)</span> is assumed to be the <strong>standard normal</strong> cumulative distribution function (CDF). To check if this assumption is reasonable, we performed nonparametric estimations of <span class="math inline">\(\Pr(y_i=1|x_{i'\beta})\)</span>. The first estimator is a Nadaraya-Watson Regression (or constant constant estimator) that assumes a constant <span class="math inline">\(m(x)=b_0(x_0)\)</span> around some neighborhood of <span class="math inline">\(x_0\)</span>:</p>
<p><span class="math display">\[
\hat{m}_h(x_0)=\frac{\sum^N_{i=1} K_x\left(\frac{x_0-x_i}{h} \right)}{\sum^N_{i=1} K_x\left(\frac{x_0-x_j}{h} \right)}y_i
\]</span></p>
<p>The Nadaraya-Watson estimator is essentially a weighted local average of the observations (weights defined by a Kernel function) at some neighborhood defined by the choice of bandwidth <span class="math inline">\(h\)</span>. The second estimator is a Local Linear Regression that, instead of assuming a constant average, lets <span class="math inline">\(m(x)\)</span> be linear in the neighborhood of <span class="math inline">\(x_0\)</span>. More concretely, the local linear regression minimizes with respect to <span class="math inline">\(b_0(x_0)\)</span> and <span class="math inline">\(b_1(x_0)\)</span>:</p>
<p><span class="math display">\[
\sum^N_{i=1} K_x\left(\frac{x_i-x_0}{h} \right)[y_i-b_0(x_0)-b_1(x_0)(x_i-x_0)]^2
\]</span></p>
<p>Both nonparametric regressions use the Epanechnikov Kernel function. Regarding the choice of bandw</p>
<div id="tbl-2" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Binary Choice Model Results
</figcaption>
<div aria-describedby="tbl-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="table1.png" class="img-fluid figure-img">
</div>
</figure>
</div>
<p>idth <span class="math inline">\(h^*\)</span>, I use the command <code>npregress</code> that performs the Leave-One-Out Cross Validation method (LOOCV) to estimate the Optimal Bandwidth size<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. <a href="#fig-2" class="quarto-xref">Figure&nbsp;2</a> compares these regressions against the probit estimation:</p>
<div id="fig-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Nonparametric Estimation of Het Probit
</figcaption>
</figure>
</div>
<p>In general, we see that the normality assumption about the error term <span class="math inline">\(\varepsilon_i\)</span> in the probit model is actually not rejected, as the probit curve of the <span class="math inline">\(\Pr(y_i=1|x_i'\beta)\)</span> tends to be within the 95% confidence intervals of both the Local Constant and Local Linear nonparametric estimators. This means that the standard probit model does not suffer from misspecification.</p>
</section>
<section id="heteroscedastic-probit-model" class="level2">
<h2 class="anchored" data-anchor-id="heteroscedastic-probit-model">Heteroscedastic Probit Model</h2>
<p>Column 2 of <a href="#tbl-2" class="quarto-xref">Table&nbsp;2</a> presents the results of the heteroscedastic probit model. This specification still assumes that the error term of the latent model follows a normal distribution, but is more flexible in the sense that it no longer assumes its variance to be 1, but that it can vary as a function of some set of explanatory variables. In this case, we only use the variable <code>years</code> to model the variance:</p>
<p><span class="math display">\[
V(\varepsilon_i|x_i)=\sigma^2_i=[\exp(\text{years}_{i}'\gamma)]^2
\]</span></p>
<p>where <span class="math inline">\(\varepsilon_i\sim N[0,\exp(\text{years}_{i}'\gamma)]\)</span>. The probability of success is now represented by:</p>
<p><span class="math display">\[
\Pr(y_i=1|x_i)  = \Phi\left( \frac{x_i'\beta}{\sigma_i} \right) = \Phi\left( \frac{x_i'\beta}{\exp(\text{years}_{i}'\gamma)} \right)
\]</span></p>
<p>Here we are primarily interested in testing whether <span class="math inline">\(\gamma\neq 0\)</span>, which seems to be the case as we see in <a href="#tbl-2" class="quarto-xref">Table&nbsp;2</a> a statistically significant coefficient. Additionally, the likelihood-ratio test of heteroskedasticity, which tests the full model with heteroskedasticity against the full model without, is significant as <span class="math inline">\(\chi^2(1) = 11.55\)</span>. Regarding the coefficients, we now see that the number of years in the residence impacts negatively the probability of voting for higher property taxes. The remaining variables are still significant and with the same sign relative to the standard probit model, but the coefficients are more pronounced.</p>
</section>
<section id="nonparametric-regression" class="level2">
<h2 class="anchored" data-anchor-id="nonparametric-regression">Nonparametric Regression</h2>
<p>We now test again the normality assumption of the heteroscedastic probit model by visually comparing its CDF with the two nonparametric alternatives already discussed:</p>
<div id="fig-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig3.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Nonparametric Estimation of Heteroscedastic Probit
</figcaption>
</figure>
</div>
<p>Clearly, the heteroscedastic alternative -that assumes normality- highly deviates from both nonparametric estimations. Hence, it seems that the normality assumption in the hetprobit model is rejected. Furthermore, the probit link function is no longer smooth when compared to the standard probit. Modeling the variance as dependent on the explanatory variable <code>years</code> makes the prediction less linear, leading to a more noisy curve than smoothed.</p>
</section>
<section id="klein-spady-semiparametric-regression" class="level2">
<h2 class="anchored" data-anchor-id="klein-spady-semiparametric-regression">Klein &amp; Spady Semiparametric Regression</h2>
<p>Semiparametric alternatives do not rely on the parametric assumptions about the shape of the error term distribution <span class="math inline">\(\varepsilon_i\)</span>. The Klein &amp; Spady method is a Single Index model with a <span class="math inline">\(\Pr(y_i|x_i)= F(x_i'\beta)\)</span> structure that only depends on <span class="math inline">\(x_i\)</span> through a single linear combination, <span class="math inline">\(x_i'\beta\)</span>, whereas the function <span class="math inline">\(F(\cdot)\)</span> is left unspecified. The estimation is based on some kind of Maximum Likelihood Estimation:</p>
<p><span class="math display">\[
L(\beta,h)=\sum^N_{i=1}(1-y_i)\ln[1-\hat{F}_{-i,n}(x_i'\beta)]+\sum^N_{i=1}y_i\ln[\hat{F}_{-i,n}(x_i'\beta)]
\]</span></p>
<p>Since <span class="math inline">\(F(\cdot)\)</span> is unknown, Klein &amp; Spady suggest replacing it with a Leave-One-Out Nadaraya-Watson estimator <span class="math inline">\(\hat{F}_{-i,n}(\cdot)\)</span>. In order to guarantee point identification, the coefficient of one continuous variable is normalized to 1, which in our case will be the variable <code>loginc</code>. Additionally, in single index models, the function <span class="math inline">\(F(\cdot)\)</span> will include any location and level shift, so the vector <span class="math inline">\(x_i\)</span> cannot include an intercept. Column 3 of <a href="#tbl-2" class="quarto-xref">Table&nbsp;2</a> shows the results of this semiparametric regression. But because we want to make some comparisons between the different models so far presented, we will also need to scale normalize the previous models, as in <a href="#tbl-2" class="quarto-xref">Table&nbsp;2</a> they are not directly comparable. <a href="#tbl-3" class="quarto-xref">Table&nbsp;3</a> shows the results of each model after scale normalization:</p>
<div id="tbl-3" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Binary Choice Models: Normalized Results
</figcaption>
<div aria-describedby="tbl-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="table2.png" class="img-fluid figure-img">
</div>
</figure>
</div>
<p>Here we see that the direction of the signs in every specification is the same: <code>years</code> and <code>logptax</code> are negatively associated with the probability of voting in favor of the tax reform. The coefficients of the property tax variable are to some degree similar across models, but there are important differences regarding the coefficient linked to the number of years in residence. First, the probit model did not show an effect statistically distinct from zero, whereas the other two models did show significant and more pronounced coefficients.</p>
<p>Between the heteroscedastic probit and the Klein &amp; Spady regression, the hetprobit seems to report a more negative effect of <code>years</code> on the probability of voting for higher taxes. In order to understand the magnitude of these differences between models, we will need to estimate marginal effects.</p>
</section>
<section id="semiparametric-regression-visualization" class="level2">
<h2 class="anchored" data-anchor-id="semiparametric-regression-visualization">Semiparametric Regression Visualization</h2>
<p><a href="#fig-4" class="quarto-xref">Figure&nbsp;4</a> visualize the Klein &amp; Spady semiparametric estimate of <span class="math inline">\(\Pr(y_i=1|x_i'\beta)\)</span> and compares it against the heteroskedastic estimation:</p>
<div id="fig-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig4.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Semiparametric Estimation of Probits
</figcaption>
</figure>
</div>
<p>The semiparametric regression in <a href="#fig-4" class="quarto-xref">Figure&nbsp;4</a> this case is quite similar to the ``U’’ shape of the nonparametric (Nadara-Watson) regression from Figure 3.a. that is based on the predicted values <span class="math inline">\(x_i'\beta\)</span> of the heteroscedastic probit to estimate the probabilities. However, we also see that the (parametric) heteroscedastic probit falls outside the 95% confidence interval area at various points ( <a href="#fig-4" class="quarto-xref">Figure&nbsp;4</a> in green). Hence, while we cannot use the hetprobit model to draw conclusions on the probability of voting for higher property taxes, we do can use a nonparametric version of the predicted values of the heteroscedastic model for that purposes.</p>
<p>Most of the behavior behind this strange shape of the link function -behavior that is mostly happening at <span class="math inline">\(x_i'\beta&lt;-5\)</span> in <a href="#fig-4" class="quarto-xref">Figure&nbsp;4</a> -, can be explained by the distribution of the <code>years</code> variable. From <a href="#fig-5" class="quarto-xref">Figure&nbsp;5</a> we can observe that this group consists of 5 observations that have an average number of years of 39, versus the 6.8 from the rest of the sample:</p>
<div id="fig-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig5.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Kernel Density Estimation of Years
</figcaption>
</figure>
</div>
<p>As we have seen from the models, the number of years has in general a negative effect on the probability of voting for more taxes, but here we have that all these 5 observations have a high number of years in the residence and all of them have <code>vote=1</code>. Hence, this group of ``outliers’’ might be generating a countervailing effect on the true point estimates of <code>years</code>.</p>
</section>
<section id="restricted-model" class="level2">
<h2 class="anchored" data-anchor-id="restricted-model">Restricted Model</h2>
<p>We now re-run the binary choice models so far discussed, but restricting the estimation for observations where the number of years in residence is smaller than 25. <a href="#tbl-4" class="quarto-xref">Table&nbsp;4</a> shows the main results after normalization to make them comparable:</p>
<div id="tbl-4" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Binary Choice Models: Normalized Results (years &lt; 25)
</figcaption>
<div aria-describedby="tbl-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="table3.png" class="img-fluid figure-img">
</div>
</figure>
</div>
<p>Here we see surprisingly similar conclusions on the point estimates across different specifications. In the standard probit model, we now see that <code>years</code> have statistically significant results, with a more intense negative effect on our dependent variable than before. The heteroscedastic probit now reports a more negative coefficient on the variable <code>logptax</code>, significant only at the 10% level, but for the number of years, we see a less pronounced effect and is no longer significant. Looking at <span class="math inline">\(\gamma\)</span>, note that now we cannot reject the null hypothesis of homoscedastic errors so that, after filtering for the extreme values of <code>years</code>, there is no evidence of this model being better than the standard probit.</p>
<p>Finally, the semiparametric model seems to be the model that changed the least. Both the direction of the signs and their significance remain as before, with <code>years</code> having a slightly less pronounced coefficient, and <code>logptax</code> reporting now a more negative effect on the probability of voting for higher taxes than before.</p>
<p>We want now to test the normality assumption, so we re-estimate the nonparametric regressions from previous exercises to make the visual comparison. In this case, I only perform the Nadaraya-Watson Estimator:</p>
<div id="fig-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig6.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Non and Semiparametric Estimation (years&lt;25)
</figcaption>
</figure>
</div>
<p>Again, we see that all both the probit and hetprobit models falls within the boundaries of the confidence interval of the nonparametric estimates. Taking all this evidence together, we can conclude that, after filtering the extreme values of <code>years</code>, the three binary choice models are no longer much different from each other. Finally, because now there is no evidence of heteroscedasticity and we did not reject the normality assumption about the error terms <span class="math inline">\(\varepsilon_i\)</span>, the standard probit model is the preferred model in my view.</p>
</section>
<section id="nonparametric-and-semiparametric-regression-comparison" class="level2">
<h2 class="anchored" data-anchor-id="nonparametric-and-semiparametric-regression-comparison">Nonparametric and Semiparametric Regression Comparison</h2>
<p>Using the standard probit estimates, we want now to graphically compare the estimates between the Nadaraya-Watson (Local Constant), the Local Linear, and the Local Quadratic regression. The following figure summarizes the results:</p>
<div id="fig-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nonparam.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Nonparametric and Semiparametric Regression - Comparison
</figcaption>
</figure>
</div>
<p>Although the curves seem to be very similar, we can identify some differences at specific points. Generally speaking, the degree of bias of the Nadaraya-Watson highly depends on the curvature or second derivative <span class="math inline">\(m''(x)\)</span> of the regression function, as well on the slope of the density of the regressors <span class="math inline">\(f'(x)\)</span>:</p>
<p><span class="math display">\[
\text{bias}[\hat{m}(x)]=\frac{h^2\mu_2}{2}\left\{m''(x)+2\frac{f'_x(x)m'(x)}{f_x(x)} \right\}+O(\frac{1}{nh})+o(h^2)
\]</span></p>
<p>Namely, the bias will be very large at a point where the density function curves a lot. In <a href="#fig-7" class="quarto-xref">Figure&nbsp;7</a> (and assuming the normality distribution is the true function), we can actually observe that the Local Constant estimator has a large and positive bias (i) between <span class="math inline">\(-1&lt;x_i'\beta&lt;0.5\)</span>, which is the place where the density is curving positively and very quickly (positive curvature) and (ii) between <span class="math inline">\(0.5&lt;x_i'\beta&lt;1.55\)</span>, marking the space where the density function is decreasing quickly (negative curvature). The local linear and local quadratic regressions also present this described behavior, but with less biasedness. The local linear is the more smoothed function among the three.</p>
<p>One reason that explains this difference may be due to the fact that the bias of the Local Linear (and Quadratic) regression does not depend on the density function of the regressors, also called design bias:</p>
<p><span class="math display">\[\begin{align*}
    \text{bias}[\hat{m}(x)]=\frac{h^2\mu_2}{2}m''(x)+o(h^2)
\end{align*}\]</span></p>
<p>In that sense, the design bias adds an extra bias to the Nadaraya-Watson estimator. Finally, we observe more differences between the estimators on the extremes. On the bottom left (between -1.2 and -2), for example, the Nadaraya-Watson starts with higher bias, but then it shifts quickly to be equal to 0 towards the left, whereas the other two (which are very similar to each other) start with less bias, but then they end up with negative probabilities towards the left. On the other extreme we find the same behavior, where the local and quadratic estimators are not bounded to be within 0 and 1.</p>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>As the optimal bandwidth formula also depends on the curvature of the density <span class="math inline">\(f''\)</span>, which is unknown, there are different ways to deal with this issue. Some impose assumptions about the unknown distribution (Plug-in methods), and others are more data-driven such as cross-validation techniques.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In contrast, the command <code>lpoly</code> uses the Rule-of-Thumb method of bandwidth selection, which is a Plug-In estimator.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Daniel Redel</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>